import{r as t,j as s}from"./pdf-DUajM2DU.js";import{y as M,aj as k,ak as B,h as N,av as H,A as V,aE as W,aF as z,aG as K,aH as Q,F as v,an as J,W as y,H as O,aI as C,aJ as X,aK as Y,K as Z,T as _,aL as $,ar as ee}from"./index-BLdSay9y.js";import{A as se}from"./AuthLayout-CWgBqCEC.js";import"./react-Cgg2GOmP.js";/* empty css               */import"./flags-BNKl102C.js";import"./TmMenuItem-CDFUEPJE.js";import"./logo-BgyMkrLu.js";function ce(){const{t:u}=M(),d=k(),P=B(),U=N(),b=H(U.breakpoints.down("sm")),j=V(W),[a,E]=t.useState(null),[m,I]=t.useState(""),[o,G]=t.useState(null),[L,{isLoading:p,data:i,isSuccess:l,error:h}]=z(),[x,F]=t.useState(!1),{data:w}=K({username:m},{skip:!x||!m}),{control:R,handleSubmit:S,watch:q}=Q({defaultValues:{username:"",password:""}}),r=q();t.useEffect(()=>{a&&o&&(r.username!==o.username||r.password!==o.password)&&E(null)},[r.username,r.password,a,o]);const D=t.useCallback(e=>{I(e.username.toUpperCase()),G(e),L({loginRequest:{username:e.username.toUpperCase(),password:e.password,tenant:j}})},[L,j]);t.useEffect(()=>{if(l&&i){const e=v.handleLoginResponse(i,m);e&&(e.resetCredentials?d("/resetPassword",{replace:!0,state:{fromLogin:!0,userAccountId:e.userAccountId}}):F(!0))}},[l,i,d,m,P]),t.useEffect(()=>{if(w&&x){const e=[];w.userAccountGroups?.forEach(c=>{if(!c.userGroup?.userRoles||c.userGroup.userRoles.length===0){console.error("⚠️ No roles found for user group:",c.userGroup?.userGroupName),console.error("   Roles value:",c.userGroup?.userRoles);return}c.userGroup.userRoles.forEach(n=>{typeof n=="object"&&n!==null&&"role"in n&&"enabled"in n?e.push({role:n.role,enabled:n.enabled}):typeof n=="string"&&e.push({role:n,enabled:!0})})}),v.setUserRolesInfo(e);const f=sessionStorage.getItem("redirectAfterLogin")||"/";d(f,{replace:!0})}},[w,x,d]),t.useEffect(()=>{if(h){const e=h?.data;e?.errors?.[0]?.message&&E(e.errors[0].message)}},[h,u]);const T=e=>{D(e)},A=t.useMemo(()=>!r.username||!r.password||p||l&&i?!0:a&&o?r.username===o.username&&r.password===o.password:!1,[r.username,r.password,p,a,o,l,i]);return J("ENTER",()=>{S(T)()},{preventDefault:!0,enableOnFormTags:!0,enabled:!A}),s.jsx(se,{children:s.jsx(y,{component:"form",onSubmit:S(T),sx:{px:b?4:6,pb:b?5:6,mt:10},children:s.jsxs(O,{gap:5,children:[s.jsx(C,{name:"username",control:R,rules:{required:u("usernameRequired")},render:({field:e})=>s.jsx(X,{...e,onChange:g=>{const f=g.target.selectionStart;e.onChange(g.target.value.toUpperCase()),requestAnimationFrame(()=>{g.target.setSelectionRange(f,f)})},testid:"loginPageUsername",margin:"normal",required:!0,fullWidth:!0,label:u("username"),autoComplete:"off",autoFocus:!0,error:!!a})}),s.jsx(C,{name:"password",control:R,rules:{required:u("passwordRequired")},render:({field:e})=>s.jsx(Y,{testid:"loginPagePassword",label:u("password"),password:e.value,setPasswordValue:e.onChange,passwordError:!!a,setPasswordError:()=>{},helperText:""})}),s.jsx(y,{sx:{minHeight:"24px"},children:a&&s.jsx(Z,{color:"error",variant:"body2",testid:"loginPageError",children:a})}),s.jsx(_,{testid:"loginPageLoginButton",type:"submit",fullWidth:!0,variant:"contained",size:"large",color:"primary",disabled:A,startIcon:p?s.jsx($,{size:20,color:"inherit"}):s.jsx(ee,{}),loading:p||i&&l,children:u("login")})]})})})}export{ce as default};
