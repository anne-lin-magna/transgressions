import{j as e,r as n}from"./pdf-DUajM2DU.js";import{e as O,y as W,h as G,av as Q,W as P,K as v,H as Z,aM as es,aN as rs,ak as as,aO as ts,aH as os,F as k,an as ns,aP as is,aQ as cs,N as K,aI as $,aK as I,aD as ds,T as ls,aL as us}from"./index-C_eGmeMG.js";import{A as ws}from"./AuthLayout-VaZL2Zfw.js";import"./react-Cgg2GOmP.js";/* empty css               */import"./flags-BNKl102C.js";import"./TmMenuItem-Da5l8T6U.js";import"./logo-BgyMkrLu.js";const ms=O(e.jsx("circle",{cx:"12",cy:"12",r:"8"})),Ps=O(e.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l4 4 4-4H6c0-3.86 3.14-7 7-7s7 3.14 7 7-3.14 7-7 7c-1.9 0-3.62-.76-4.88-1.99L6.7 18.42C8.32 20.01 10.55 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m2 8v-1c0-1.1-.9-2-2-2s-2 .9-2 2v1c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-3c0-.55-.45-1-1-1m-1 0h-2v-1c0-.55.45-1 1-1s1 .45 1 1z"})),_=(s,u)=>{const w=[{translationKey:"1uppercase",regex:/[A-Z]/},{translationKey:"1lowercase",regex:/[a-z]/},{translationKey:"1specialCharacter",regex:/[!@#$%^&*()_+\-=[\]{};':'\\|,.<>/?]/},{translationKey:"1numericalCharacter",regex:/\d/},{translationKey:"minimum8Characters",regex:/.{8,}/},{translationKey:"notSameAsCurrentPassword",regex:new RegExp(`^(?!${u?.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}$)`)}];return s&&s.length>0&&w.push({translationKey:"notSameAsUsername",regex:new RegExp(`^(?!${s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}$)`)}),w};function H({password:s,username:u="",currentPassword:w}){const{t:i}=W(),c=G(),m=Q(c.breakpoints.down("sm")),A=n.useMemo(()=>_(u,w).map(o=>o.translationKey==="notSameAsUsername"||o.translationKey==="notSameAsCurrentPassword"?{met:s.length>0&&o.regex.test(s),label:i(o.translationKey)}:{met:o.regex.test(s),label:i(o.translationKey)}),[u,w,s,i]);return e.jsx(P,{sx:{display:"flex",flexDirection:"column",alignItems:m?"flex-start":"center",px:m?0:2},children:e.jsxs(P,{children:[e.jsxs(v,{variant:"body1",sx:{mb:2,fontWeight:500,alignSelf:m?"flex-start":"center"},testid:"passwordRequirementsTitle",children:[i("passwordMustContainAtLeast"),":"]}),e.jsx(Z,{spacing:1,alignItems:"flex-start",children:A.map((l,o)=>{let f;return l.met?f=e.jsx(es,{sx:{fontSize:20,color:"success.main"}}):s.length===0?f=e.jsx(ms,{sx:{fontSize:8,color:"text.secondary"}}):f=e.jsx(rs,{sx:{fontSize:20,color:"error.main"}}),e.jsxs(P,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[f,e.jsx(v,{variant:"body1",sx:{color:s.length===0?"text.secondary":l.met?"success.main":"text.secondary",fontSize:"1rem"},testid:`passwordRequirement${o}`,children:l.label})]},o+l.label)})})]})})}function Cs(){const{t:s}=W(),u=as(),w=G(),i=Q(w.breakpoints.down("sm")),[c,m]=n.useState(null),[A,l]=n.useState(null),[o,f]=n.useState(null),[S,E]=n.useState(!1),[J,V]=n.useState(!1),z=u.state?.userAccountId,[D,{isLoading:h,isSuccess:p,error:M}]=ts(),{control:R,handleSubmit:U,watch:X,setError:d,clearErrors:x,formState:{errors:g}}=os({defaultValues:{currentPassword:"",newPassword:"",confirmPassword:""}}),a=X(),j=n.useMemo(()=>k.getUserName()||"",[]),C=n.useMemo(()=>_(j).map(t=>({label:s(t.translationKey),regex:t.regex})),[j,s]),T=u.state?.fromLogin===!0;n.useEffect(()=>{if(!p&&T){const r=b=>(b.preventDefault(),!0),t=()=>{p||k.doLogout(!0)};return window.addEventListener("beforeunload",r),window.addEventListener("unload",t),()=>{window.removeEventListener("beforeunload",r),window.removeEventListener("unload",t)}}},[p,T]),n.useEffect(()=>{c&&o&&(a.currentPassword!==o.currentPassword||a.newPassword!==o.newPassword||a.confirmPassword!==o.confirmPassword)&&(m(null),x())},[a,c,o,x]),n.useEffect(()=>{if(a.newPassword){x("newPassword");for(const r of C)if(!r.regex.test(a.newPassword)){const t=r.label===s("minimum8Characters"),b=r.label===s("notSameAsUsername"),L=r.label===s("notSameAsCurrentPassword");let y=r.label;!t&&!b&&!L&&(y=`${s("passwordMustContainAtLeast")}: ${r.label}`),d("newPassword",{type:"manual",message:y});return}if(a.currentPassword&&a.newPassword===a.currentPassword){d("newPassword",{type:"manual",message:s("newPasswordSameAsOld")});return}}},[a.newPassword,a.currentPassword,d,x,s,C]),n.useEffect(()=>{a.confirmPassword&&a.newPassword&&(a.newPassword!==a.confirmPassword?d("confirmPassword",{type:"manual",message:s("passwordsDoNotMatch")}):x("confirmPassword"))},[a.newPassword,a.confirmPassword,d,x,s]);const q=n.useCallback(r=>{if(r.newPassword!==r.confirmPassword)return d("confirmPassword",{type:"manual",message:s("passwordsDoNotMatch")}),!1;if(r.currentPassword===r.newPassword)return d("newPassword",{type:"manual",message:s("newPasswordSameAsOld")}),!1;for(const t of C)if(!t.regex.test(r.newPassword)){const b=t.label===s("minimum8Characters"),L=t.label===s("notSameAsUsername"),y=t.label===s("notSameAsCurrentPassword");let B=t.label;return!b&&!L&&!y&&(B=`${s("passwordMustContainAtLeast")}: ${t.label}`),d("newPassword",{type:"manual",message:B}),!1}return!0},[d,s,C]);n.useEffect(()=>{h&&E(!0)},[h]),n.useEffect(()=>{p&&S&&(l(s("passwordResetSuccess")),V(!0),E(!1),setTimeout(()=>{k.doLogout(!0)},500))},[p,S,s]),n.useEffect(()=>{if(M&&S){const r=M,t=r?.data?.errors?.[0]?.message||r?.data?.message||s("passwordResetFailed");m(t),E(!1)}},[M,S,s]);const Y=n.useCallback(r=>{!q(r)||!z||(f(r),m(null),l(null),D({userAccountPasswordChangeRequest:{userAccountId:z,oldPassword:r.currentPassword,newPassword:r.newPassword}}))},[q,D]),F=r=>{Y(r)},ss=n.useCallback(()=>{V(!1)},[]),N=n.useMemo(()=>!a.currentPassword||!a.newPassword||!a.confirmPassword||g.currentPassword||g.newPassword||g.confirmPassword||h?!0:c&&o?a.currentPassword===o.currentPassword&&a.newPassword===o.newPassword&&a.confirmPassword===o.confirmPassword:!1,[h,c,o,a.currentPassword,a.newPassword,a.confirmPassword,g.currentPassword,g.newPassword,g.confirmPassword]);return ns("ENTER",()=>{U(F)()},{preventDefault:!0,enableOnFormTags:!0,enabled:!N}),T?e.jsxs(e.Fragment,{children:[e.jsx(cs,{testid:"resetPasswordSuccess",snackbarType:"success",message:A||s("passwordResetSuccess"),isOpen:J,onClose:ss}),e.jsx(ws,{wide:!0,children:e.jsx(P,{component:"form",onSubmit:U(F),sx:{px:i?4:6,pb:i?5:6,mt:10},children:e.jsxs(K,{container:!0,spacing:3,children:[e.jsx(K,{size:{xs:i?12:6,md:i?12:6},children:e.jsxs(Z,{children:[e.jsx($,{name:"currentPassword",control:R,rules:{required:s("currentPasswordRequired")},render:({field:r})=>e.jsx(I,{testid:"resetPasswordCurrentPassword",label:s("currentPassword"),password:r.value,setPasswordValue:r.onChange,passwordError:!!c,setPasswordError:()=>{},helperText:" ",autoFocus:!0})}),e.jsx($,{name:"newPassword",control:R,rules:{required:s("newPasswordRequired")},render:({field:r,fieldState:t})=>e.jsx(I,{testid:"resetPasswordNewPassword",label:s("newPassword"),password:r.value,setPasswordValue:r.onChange,passwordError:!!t.error,setPasswordError:()=>{},helperText:" "})}),e.jsx($,{name:"confirmPassword",control:R,rules:{required:s("confirmPasswordRequired")},render:({field:r,fieldState:t})=>e.jsx(I,{testid:"resetPasswordConfirmPassword",label:s("confirmPassword"),password:r.value,setPasswordValue:r.onChange,passwordError:!!t.error,setPasswordError:()=>{},helperText:t.error?.message||" "})}),i&&e.jsx(P,{sx:{mt:-3},children:e.jsx(H,{password:a.newPassword||a.confirmPassword||"",username:j})}),e.jsx(P,{sx:{minHeight:"24px"},children:e.jsx(ds,{in:!!c,timeout:500,children:e.jsx(v,{color:"error",variant:"body2",testid:"resetPasswordPageError",children:c||""})})}),e.jsx(ls,{testid:"resetPasswordSubmitButton",type:"submit",fullWidth:!0,variant:"contained",size:"large",color:"primary",disabled:N,sx:{mt:5},startIcon:h?e.jsx(us,{size:20,color:"inherit"}):e.jsx(Ps,{}),children:s("resetPassword")})]})}),!i&&e.jsx(K,{size:{xs:i?12:6,md:i?12:6},children:e.jsx(H,{password:a.newPassword||"",currentPassword:a.currentPassword||"",username:j})})]})})})]}):e.jsxs(P,{marginTop:10,textAlign:"center",children:[e.jsx(is,{color:"error",fontSize:"large"}),e.jsx(v,{testid:"securedContentAccessDenied",variant:"h4",color:"error",textAlign:"center",children:s("accessDenied")})]})}export{Cs as default};
